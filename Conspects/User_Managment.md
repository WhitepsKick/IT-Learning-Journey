#Команды и информация для управления пользователями
## SuperUser и SUDO команды
Root также известен как SuperUser имеет неограниченные возможности, способен получить доступ к любым файлам и использовать любые команды
Чтобы минимизировать риски авторизированные пользователи могут использовать команду `sudo` (SuperUser do) вместо того что логиниться под root
если попробовать получить доступ к `etc/shadow` то линукс выдаст нам отказано в доступе
_(чтобы узнать кто владелец файла или директории мы по базе можем использовать `ls`)_
- чтобы получить доступ к данному файлу нам надо использовать команду `sudo /etc/shadow`
- также можно использовать команду `su (имя пользователя)` но для безопасности надо понимать что будешь делать иначе можно допустить критические ошибки
### /ETC/SUDOERS
- `/etc/sudoers` в данном файле конфигурации показывает пользователей и группы которые имеют право запускать команды от имени `SU`
    - этот файл можно редактировать с помощью `visudo` данная утилита откроет этот файл и перед сохранением будет проверять синтаксис (лучше никогда не редактировать напрямую через базовые команды)
#### Основное содержимое SUDOERS
- `root ALL=(ALL:ALL) ALL` означает что пользователь `root` имеет право запускать команды со всех хостов
далее это справедливо для всех пользователей которые принадлежат к группе `admin` и группе `sudo` <img width="222" height="60" alt="image" src="https://github.com/user-attachments/assets/280a87ff-bcc0-46a5-8326-e290a3b1822d" />
- также данные права аналогично можно дать и всем остальным пользователям или группам
- `NOPASSWD: ALL` отключает запрос пароля при выполнении команды от имени администратора
- также можно указать выполнение команды от имени администратора для _конкретного пользователя_ 
`superuser1 ALL=/usr/bin/passwd` (мы дали администраторские полномочия для выполнения данной команды для конкретного пользователя)
- Также с помощью `Cmnd_Alias` можно определить псевдоним для команды если нужно дать доступ к ограниченному
кругу нескольких задач `Cmnd_Alias SYSTEM = /usr/bin/passwd, /usr/sbin/usermod`
данным командам назначен псевдоним `SYSTEM` и далее в файле можно назначить данные команды польз. или группе `%developers ALL=SYSTEM`
</br>

### /ETC/PASSWD
- `/etc/passwd` данный файл содержит данные о пользователях и их ID
  - `root:x:0:0:root:/root:/bin/bash`
    1) Имя пользователя
    2) Наличие пароля
       - `x` показывает что есть зашифрованный пароль
       - `*` показывает что аккаунт заблокирован и не может быть использован для логина
       - пустое поле показывает что нет пароля
    3) USERID (UID)
    4) Group ID (GID)
    5) Gecos field - поле для комментариев
    6) Home Directory - абсолютный путь к домашней директории пользователя
    7) Default Shell - Дефолтный терминал для пользователя (bin/bash)
  - также в данном файле есть много пользователей которые не являются пользователями
    - `Daemon` используется программами для использования фоновых процессов
  - Изменение файла `/etc/passwd`
    - данный файл можно редактировать с помощью `vipw` но не рекомендуется тк высокая вероятность накосячить, вместо этого можно использовать команды редактирования пользователей
</br>

## USERADD
- Аргументы:
  - `-b BASE_DIR` устанавливает базовый каталог BASE_DIR для дом.каталога новой учетки
  - `-m` создает домашнюю директорию если она еще не существует
  - `-d /home/test-user` устанавливает данную директорию в качестве домашней
  - `-c` добавляет коментарий
  - `-g test` указывает группу в которую попадает пользователь, можно использовать с GID или именем группы, используется в сочетании с `-N` которая отменяет создание группы с именем пользователя
  - `-G users, wheel` указывает список доп.групп, перечисляются через запятую
  - `-s /bin/bash` позволяет настроить доступ к shell
  - `-r` создает системного пользователя. Используется, когда нужно настроить службу на работу из под конкретного пользователя. По умолчанию данные таких пользователей не вносятся в `/etc/shadow`, для них не создается домашняя папка
  - `-u` позволяет указать свой UID, который будет присвоен новому пользователю, в качестве UID указывается положительное целое число, оно должно быть уникальным
  - `-e 2021-01-01` указывает дату до которой акк будет активен
  - `-f 3` указывает количество дней до блокировки пользователя, до того как его пароль станет недействителен.
- Пример: `useradd -m -u 666 -d /home/users/test-user -c "Тестовый пользователь" -g test -N -e 2026-01-01 -s /bin/bash test-user`
- В примере мы создаём тестового пользователя test-user с идентификатором 666, домашней папкой в /home/users/test-user, комментарием «Тестовый пользователь» и доступом к командной оболочке. Учётная запись будет действительна до 2026-01-01.
- более подробную инфу можно увидеть с помощью команды `man useradd`
- `passwd test-user` команда позволяет изменить пароль для пользователя
## USERMOD
`usermod [options] USERNAME`
- Аргументы:
  - `-a` добавляет пользователя в доп. группы указанные в аргументе `-G` не удаляя польз. из др. групп
  - `-G GROUPS` устанавливает GROUPS в качестве списка доп. ГРУПП
  - `-c` устанавливает новое значение комментария
  - `-d` устанавливает новый дом. каталог для учетки
  - `-e` устанавливает дату истечения срока действия учетки на указанное
  - `-g GROUP` принудительнор применяет GROUP в качестве новой осн. группы
  - `-l` устанавливает новый логин польз.
  - `-L` блокирует учетку
  - `-m` перемезает содержимое дом. каталога в новое место (использовать только с -d)
  - `-p` устанавливает пароль
  - `-r` удаляет польз. только из доп. групп указанных в параметре `-G` не удаляя польз. из др. групп
  - `-s SHELL` устанавливает `SHELL` в качестве оболочки входа для учетной записи польз.
  - `-u UID` назначает новый UID для учетки
  - `-U` разблокирует учетку
- Примеры:
  - `sudo usermod -aG users superuser1` добавляет группу `users` к группам пользователя
  - `sudo usermod -d /home/superuser1_new superuser1` устанавливает новую домашнюю директорию для польз.
  - `sudo usermod -L superuser1` блокирует учетку
## USERDEL
`userdel [options] USERNAME`
- Аргументы:
  - `-f` принудительно выполняет действие, даже если польз в системе
  - `-r` удаляет домашний каталог польз.
- Примеры:
  - `sudo userdel superuser1` просто удаление польз
  - `sudo userdel -r superuser1` удаление пользователя вместе с домашним каталогом

</br>

## ПОЛУЧЕНИЕ ИНФОРМАЦИИ О ПОЛЬЗОВАТЕЛЯХ
- `id USERNAME(EMPTY)` выводит информацию о пользователе
- `users` выводит список всех залогиненных пользователей в текущий момент
- `who` более детальная информация чем `users`
- `w` чтобы посмотреть что делает пользователь (команда отображает имена всех подключенных пользователей)
<img width="512" height="135" alt="image" src="https://github.com/user-attachments/assets/d10fe919-002d-4664-ae10-65d7ee90f92a" />

### подробная информация об опр. польз
`/etc/passwd`
- также можно использовать с командой `grep`
  - Пример: `grep superuser1 /etc/passwd`

</br>

## УПРАВЛЕНИЕ ПАРОЛЯМИ
### КОМАНДА PASSWD
`passwd [options] [USERNAME]`
- Аргументы:
  - `-d` удаляет пароль для указанной учетки
  - `-e` делает пароль принудительно истекшим для указанной учетки
  - `-k` меняет пароль, только если его срок действия истек
  - `-l` блокирует пароль указ. учетки
  - `-S` сообщает о состоянии пароля указанной учетки
  - `-u` разблокирует пароль указ. учетки
  - `-n` минимальное кол-во дней до смены пароля
  - `-i` автоматом прекращает срок действия учетки если она не функционировала в течении периода заданного параметром
  - `-w` устанавливает кол-во дней до истечения срока действия пароля, в течение которых польз. будет получать предупр. об истечении срока действия
  - `-x` макс.дней до смены пароля
- Например: создадим пользователя и изменим ему пароль и потом удалим его
  - `sudo useradd superuser1`
  - `sudo passwd superuser1`
  - <img width="541" height="129" alt="image" src="https://github.com/user-attachments/assets/c6ed3917-4d8c-4340-aca7-af06e560ffca" />
  - `sudo passwd -d superuser1`
### НАСТРОЙКА ПОЛЬТИКИ ПАРОЛЕЙ
`/etc/security/pwquality.conf` - файл определяет правила и настройки, которые контролируют сложность и надежность паролей пользователей.
- опции файла:
  - minlen - определяет мин. длину пароля
  - minclass - устанавливает мин. кол-во. требуемых классов символов (строчные, прописные и цифры)
  - maxrepeat - устанавливает количество последовательных одинаковых символов (допуск. два посл. символа)
  - minsequence - устанавливает мин. длину последоватльности
  - maxclassrepeat - ограничивает максимальное кол-во посл. символов из одного и того же класса симв. (допуск. 4 посл. символа из одного и того же класса)
  - reject_username - гарантирует что пароль не будет содержать имя польз
### CHAGE
`chage [options] USERNAME` - применяется для изменения политики устаревания и срока действия пароля польз.
- Аргументы:
  - `-d` устан. дату посл. смены пароля
  - `-E` устанавливает дату истечения срока действия учетки
  - `-i` автоматически прекразает срок действия учетки если она не использовалась при заданном периоде
  - `-l` показывает инфу об устаревании учетки
  - `-m` минимальное количество дней до смены пароля
  - `-M` макс. кол-во дней до смены пароля
  - `-w` кол-во дней до истечения срока действия пароля в течении которых польз. будет получать предупреждения об истечении срока действия
- Пример:
  - `sudo useradd superuser1`
  - `sudo chage superuser1`
  - <img width="577" height="211" alt="image" src="https://github.com/user-attachments/assets/76d25def-a1a0-4a52-9823-479e83c336b4" />
  - `sudo chage -d 2023-12-1 superuser1` изменили дату последней смены пароля
  - `sudo chage -E 2025-12-12` изменили дату истечения пароля
  - `pwck` проверяет согласованность /etc/passwd, /etc/shadow, /etc/group
## Управление группами
### Добавление группы
`groupadd [options] GROUP` - добавляет новую группу в систему
- Аргументы:
  - `-g GID` устанавливает GID для новой группы
  - `-p` применяет пароль для новой группы
  - `-U` задает список пользователей-членов этой группы
- Пример: `sudo groupadd developers`
### Получение групп
`/etc/group` хранит информацию о всех созданных группах </br>

<img width="171" height="192" alt="image" src="https://github.com/user-attachments/assets/c98512d4-21f3-44b2-b54e-21433972cdc7" />

### Изменение групп
`groupmod [options] GROUP`
- Аргументы:
  - `-a` добавляет пользователей, упомянутых опцией `-U` в группу не удаляя уже имеющихся участников
  - `-g` изменить идентификатор группы на GID
  - `-n` изменяет имя группы на указанное
  - `-p` изменяет пароль
  - `-U` список пользователей-членов группы
- Пример: `sudo groupmod -n testets developers` изменил имя группы на новое (testers)
### Удаление группы
`groupdel [options] GROUP` с функцией `-f` принудительно удаляет группу даже если это основная группа пользователя
## Разрешения
### CHMOD
`chmod [options] разрешения файл/каталог` - используется для изменения прав доступа к файлу или каталогу. </br>
`-R` - рекурсивно даст разрешения всем файлам и подпапкам в папке для которой мы используем команду
- Пример: `chmod 700 -R /home/superuser1` устанавливает права rwx только для пользователя-владельца папки и всего что внутри, для остальных (групп и других) нет доступа
### CHOWN 
`chown [OPTIONS] USERNAME:GROUP файл/каталог` - изменяет владельца и группы указанного файла или каталога.
Пример: `sudo chown -R sudouser1:users /home/newuser/test`
### chgrp
`chgrp [OPTIONS] GROUP файл/каталог` позволяет изменить группу для каталога, не затрагивая владельца
Пример: `sudo chgrp -R root /home/newuser/test`
### NEWGRP
`newgrp GROUP` позволяет поменять основную группу пользователя
## SUID, SGID, БИТ ФИКСАЦИИ
`SUID` (4) - применяется тогда, когда пользователю нужны права `root` которых у него нету, например для изменения пароля, обозначается буквой `s` вместо `x` в разрешениях  
<img width="495" height="55" alt="image" src="https://github.com/user-attachments/assets/745fcd50-e78f-486c-91c9-9532e7e8016c" />
</br>
`SGID` (2) - применяется при работе с разделяемыми каталогами. Когда пользователь создает файл или каталог в качестве Группы-Владельца устанавливается основная группа пользователя который создал объект, SGID устанавливает для всех объектов созданных в каталоге группу владельца главного каталога  
`sticky bit` (применяется только для каталогов) (1) применяется для того чтобы пользователи которые работают в одном общем каталоге не могли удалять объекты друг друга, </br> при применении подобного бита пользователь может удалять файлы если верно хотя бы одно из следующих условий:
- если пользователь является владельцем файла
- если пользователь является владельцем каталоге, где расположен файл
Для применения данных разрешений используется команда `chmod`
- Пример: `chmod 2755 /somedir` - добавляет рарешение `SGID` к каталогу и устанавливает `rwx` для польз и `rx` для группы и других
- `chmod 3755 /somedir` то же самое только `SGID` + `STICKY BIT`
## Списки контроля доступом ACL
### ACL (Acces control list)
Данные списки предоставояют еще одну возможность предоставлять разрешения нескольким пользователям и группам для одного и того же файла или каталога.  
ACL помогает решить ограничения других общих инструментов управления разрешениями:  
- У файла/каталога может быть только один пользователь-владелец и одна группа-владелец
- не работает наследование разрешений, чтобы разрешения каталога передавались его файлам и подкаталогам  
`setfacl [options] operation entity:entityname:permissios file`  
- Аргументы:
  - `-d` устанавливает ACL по умолчанию. Также наследуется подкаталогами и файлами
  - `-k` удаляет список ACL по умолчанию
  - `-R` рекурсивно применяет настройки ACL
ACL по умолчанию предназначен для новых файлов и не влияет на существующие файлы.
Без опции `-d` команда `setfacl` работает только с сущ. файлами.
Чтобы убедиться что все новые файлы получат же лаемые настройки ACL, для начала надо использовать `-d` а потом `-R` без `-d`
  
OPERATIONS - Устанавливает, что надо сделать, добавить или удалить настройку ACL.
- `-set` используется для установки ACL. (заменит любой существующий ACL)
- `-m` дополняет текущие настройки ACL, без полной замены
- `-x` удаляет сущ. ACL
`entity` и `entity name` - объекта и имя объекта, которые опр. для кого надо установить ACL.
Сущетсвуют два типа: u (польз.) g (груп.)  
После указания типа объекта надо указать имя объекта.  
`permissions` разрешения которые надо установить с помощью списков управления доступом  
`file` имя файла или каталога к которому надо применить списки ACL
- Пример: `setfacl -m g:users:rwx /somedir` - для определенного каталога у группы users устанавливаются разрешения `rwx` и оператор `-m` говорит что надо добавить к существующему ACL
- `setfacl -d -m g:users:rwx,g:developers:rx / somedir` - также можно делать для нескольких групп или пользователей  
`getfacl file` - позволяет получить информацию о списках ACL
<img width="491" height="186" alt="image" src="https://github.com/user-attachments/assets/73bcc82d-0ff6-460a-9d90-428ae4c835f3" />
То есть если мы создадим объект, то список контроля доступа будет такой, что мы будем владельцами каталога и файлов независимо от того в каком или чьем каталоге мы создали наши объекты. После того как мы изменим списки доступа для каталога важно будет изменить эти списки доступа и для всех других файлов которые были созданы до последнего изменения списков в этом каталоге `sudo setfacl -R -m g:users:rwx /test`.  
## ПОЛЬЗОВАТЕЛЬСКИЕ НАСТРОЙКИ И ПЕРЕМЕННЫЕ ОКРУЖЕНИЯ
